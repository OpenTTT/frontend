<div [formGroup]="formGroup">
  <table mat-table [dataSource]="orders" formArrayName="orders">
    <ng-container matColumnDef="destination">
      <th mat-header-cell *matHeaderCellDef>Station</th>
      <td mat-cell *matCellDef="let order; let i=index;" class="big">
        <mat-form-field [formGroupName]="i">
          <input matInput
                 type="text"
                 formControlName="destination"
                 [matAutocomplete]="stationsAutocomplete"
                 (focus)="onFocusChanged(i)"
          >
        </mat-form-field>
        <mat-autocomplete #stationsAutocomplete>
          <mat-option *ngFor="let option of filteredStations" [value]="option">
            {{ option }}
          </mat-option>
        </mat-autocomplete>
      </td>
    </ng-container>

    <ng-container matColumnDef="stayingTime">
      <th mat-header-cell *matHeaderCellDef>Stay time</th>
      <td mat-cell *matCellDef="let order; let i=index;">
        <mat-form-field [formGroupName]="i">
        <input type="number"
               matInput
               [value]="order.stayingTime"
               min="0"
               max="256"
               formControlName="stayingTime"
        ></mat-form-field>
      </td>
    </ng-container>

    <ng-container matColumnDef="travelingTime">
      <th mat-header-cell *matHeaderCellDef>Travel time</th>
      <td mat-cell *matCellDef="let order; let i = index">
        <mat-form-field [formGroupName]="i">
        <input
          type="number"
          matInput
          [value]="order.travelingTime"
          min="0"
          max="256"
          formControlName="travelingTime"
        ></mat-form-field>
      </td>
    </ng-container>

    <ng-container matColumnDef="additionalControls">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let order; let i = index; let first = first; let last = last;">
        <small *ngIf="!last">
          <button mat-icon-button (click)="onRowUp(i)" [ngClass]="{hidden: first}">
            <mat-icon>arrow_upward</mat-icon>
          </button>

          <button mat-icon-button (click)="onRowDown(i)" [ngClass]="{hidden: (i == orders.length-2)}">
            <mat-icon>arrow_downward</mat-icon>
          </button>

          <button mat-icon-button (click)="onRowDeleted(i)">
            <mat-icon>delete</mat-icon>
          </button>
        </small>
        <small *ngIf="last">
          <button mat-icon-button (click)="onSaveRow()">
            <mat-icon>add</mat-icon>
          </button>
        </small>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row
        *matRowDef="let row; columns: displayedColumns; let even = even; let i = index"
        [ngClass]="{even: even}"
    ></tr>
  </table>
</div>
