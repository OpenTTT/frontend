<form [formGroup]="scheduleDispatchForm">
  <mat-card>
    <mat-card-title>Dispatch for timetable {{ scheduleDispatchForm.value['timetable'] }}</mat-card-title>
    <div>
      A scheduled dispatch that repeats every
      <strong><input type="number" class="slim number" formControlName="intervalInMinutes"></strong>
      minutes
    </div>
    <div>
      Within that interval, it begins a new schedule at the following offsets:
      <ul formArrayName="departures">
        <li *ngFor="let departure of scheduleDispatchForm.value['departures']; let i = index">
          <strong><input type="number" class="slim number" [formControlName]="i"></strong> minutes
          <small><button mat-icon-button (click)="removeDeparture(i)"><mat-icon>delete</mat-icon></button></small>
        </li>
        <li>
          <input type="number"
                 [formControl]="newDepartureControl"
                 class="slim number"
                 (blur)="addDeparture()"
                 #newDepartureInput
          > minutes
        </li>
      </ul>
      <small>Explanation: With a interval of 60 minutes and departures at offsets 0 and 30, the train would start at 00:00 and 00:30</small>
    </div>
  </mat-card>
</form>

<div id="compact-timetable-schedule">
  <mat-card>
    <mat-card-title>Timetable</mat-card-title>
    <div id="timetable-table" *ngIf="dispatch; else timetableLoading">
      <div [ngSwitch]="editMode">
        <app-timetable-table [timetableId]="dispatch.timetableId"
                             *ngSwitchCase="false"
        ></app-timetable-table>
        <app-timetable-editor [timetableId]="dispatch.timetableId"
                              *ngSwitchCase="true"
                              (timetableChanged)="onTimetableChanges()"
        >
        </app-timetable-editor>
      </div>
    </div>
    <ng-template #timetableLoading>
      The timetable is loading...
    </ng-template>

    <button mat-raised-button color="primary" (click)="toggleEditMode()"><mat-icon>edit</mat-icon> Edit</button>
  </mat-card>

  <mat-card>
    <mat-card-title>Schedule</mat-card-title>
    <div id="schedule-table" *ngIf="dispatch; else scheduleLoading;">

      <app-departure-table [numSchedules]="numberOfDeparturesDisplayed.value"
                           [dispatchId]="id"
                           [dispatchChange]="dispatchChange.asObservable()"
      >
      </app-departure-table>

    </div>
    <ng-template #scheduleLoading>
      The schedule is loading...
    </ng-template>

    <div>
      Display # of departures:
        <input [formControl]="numberOfDeparturesDisplayed"
               class="slim number"
               type="number" max="25" min="1"
               autofocus
        >
    </div>
  </mat-card>

</div>
